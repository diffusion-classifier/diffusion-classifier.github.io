<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <meta charset="utf-8">
    <meta property="og:title" content="Diffusion Classifier" />
    <meta property="og:description" content="Your Diffusion Model is Secretly a Zero-Shot Classifier" />
    <meta property="og:url" content="https://diffusion-classifier.github.io/" />
    <!-- TODO: UPDATE -->
    <!-- <meta property="og:image" content="https://internet-explorer-ssl.github.io/static/images/preview.jpg" /> -->
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="628" />
    <meta name="description"
        content="Diffusion Classifier leverages pretrained diffusion models to perform zero-shot classification without additional training." />
    <meta name="keywords"
        content="diffusion models, generative models, zero-shot learning, supervised learning, classification, Bayes' theorem, evidence lower bound (ELBO), Monte Carlo estimation, computer vision, deep learning" />
    <meta name="viewport" content="width=628, initial-scale=0.5" />
    <!-- twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Diffusion Classifier" />
    <meta name="twitter:description"
        content="Diffusion Classifier leverages pretrained diffusion models to perform zero-shot classification without additional training." />
    <meta name="twitter:url" content="https://diffusion-classifier.github.io/" />
    <meta name="twitter:image" content="https://diffusion-classifier.github.io/static/images/preview.jpg" />
    <meta name="twitter:site" content="@pathak2206" />
    <meta name="twitter:image" content="https://diffusion-classifier.github.io/static/images/preview.jpg" />
    <meta name="twitter:image:src" content="https://diffusion-classifier.github.io/static/images/preview.jpg" />
    <meta name="twitter:image_alt" content="Diffusion Classifier" />

    <title>Diffusion Classifier</title>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RYWGEJGP6S"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-RYWGEJGP6S');
    </script>

    <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro" rel="stylesheet">

    <link rel="stylesheet" href="./static/css/bulma.min.css">
    <link rel="stylesheet" href="./static/css/bulma-carousel.min.css">
    <link rel="stylesheet" href="./static/css/bulma-slider.min.css">
    <link rel="stylesheet" href="./static/css/fontawesome.all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
    <link rel="stylesheet" href="./static/css/index.css">
    <link rel="stylesheet" href="https://use.typekit.net/iag3ven.css">

    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism-coy.min.css"/> -->
    <link rel="stylesheet" href="./static/css/prism.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs-bibtex@2.0.1/prism-bibtex.min.js">
    </script>

    <!-- https://realfavicongenerator.net/ -->
    <link rel="apple-touch-icon" sizes="180x180" href="./static/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./static/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./static/favicon/favicon-16x16.png">
    <link rel="manifest" href="./static/favicon/site.webmanifest">
    <link rel="shortcut icon" href="./static/favicon/favicon.ico">
    <meta name="apple-mobile-web-app-title" content="Diffusion Classifier">
    <meta name="application-name" content="Diffusion Classifier">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="./static/favicon/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <script defer src="./static/js/fontawesome.all.min.js"></script>
    <script src="./static/js/bulma-carousel.min.js"></script>
    <script src="./static/js/bulma-slider.min.js"></script>

    <!-- mathjax -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
</head>

<body>
    <section class="hero">
        <div class="hero-body">
            <div class="container is-max-desktop">
                <div class="columns is-centered">
                    <div class="column has-text-centered">
                        <p style="padding: 20px;" />
                        <p style="padding: 20px;" />
                        <h1 class="title is-1 publication-title">
                            <span id="main-title">
                                Your Diffusion Model is Secretly a Zero-Shot Classifier
                            </span>
                        </h1>
                        <div class="is-size-5 publication-authors">
                            <!-- TODO: FIX -->
                            <span class="author-block">
                                <a href="http://alexanderli.com/" target="_blank">Alexander C.
                                    Li</a>
                            </span>
                            &nbsp;
                            &nbsp;
                            <span class="author-block">
                                <a href="https://mihirp1998.github.io/" target="_blank">Mihir Prabhudesai</a>
                            </span>
                            &nbsp;
                            &nbsp;
                            <span class="author-block">
                                <a href="https://shivamduggal4.github.io/" target="_blank">Shivam Duggal</a>
                            </span>
                            &nbsp;
                            &nbsp;
                            <span class="author-block">
                                <a href="https://ellisbrown.github.io/" target="_blank">Ellis Brown</a>
                            </span>
                            &nbsp;
                            &nbsp;
                            <span class="author-block">
                                <a href="https://www.cs.cmu.edu/~dpathak/" target="_blank">Deepak Pathak</a>
                            </span>
                        </div>
                        <p style="padding: 2px;" />
                        <div class="is-size-5 publication-authors">
                            <span class="author-block">Carnegie Mellon University</span>
                            <!-- <br style="line-height: 2px" /> -->
                            <!-- <span class="author-block" style="font-size: 0.7em; font-style: italic;"><sup>*</sup>Equal
                                contribution</span> -->

                        </div>

                        <p style="padding: 20px;" />

                        <div class="buttons is-centered">
                            <button class="external-link button is-medium is-ghost publication-links is-rounded">
                                <a href="https://arxiv.org/abs/2302.14051" target="_blank"
                                    style="text-decoration:none;">
                                    <span class="icon is-small">
                                        <i class="ai ai-arxiv"></i>
                                    </span>
                                    <span>arXiv</span>
                                </a>
                            </button>
                            <button class="external-link button is-medium is-ghost publication-links is-rounded">
                                <a href="./static/docs/InternetExplorer.pdf" target="_blank">
                                    <span class="icon is-small">
                                        <i class="fas fa-file-pdf"></i>
                                    </span>
                                    <span>pdf</span>
                                </a>
                            </button>
                            <!-- <button class="external-link button is-medium is-ghost publication-links is-rounded">
                                <a href="https://youtu.be/1hYtGZ0CUSA" target="_blank">
                                    <span class="icon">
                                        <i class="fab fa-youtube"></i>
                                    </span><span>video</span>
                                </a>
                            </button> -->
                            <!-- <button class="external-link button is-medium is-ghost publication-links is-rounded">
                                <a href="./static/docs/InternetExplorer.pptx" target="_blank">
                                    <span class="icon is-small">
                                        <i class="fas fa-file-powerpoint"></i>
                                    </span>
                                    <span>slides</span>
                                </a>
                            </button> -->
                            <button class="external-link button is-medium is-ghost publication-links is-rounded">
                                <a href="https://github.com/internet-explorer-ssl/internet-explorer" target="_blank">
                                    <span class="icon is-small">
                                        <i class="fab fa-github"></i>
                                    </span>
                                    <span>code</span>
                                </a>
                            </button>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="section">
        <div class="container is-max-desktop">
            <!-- Abstract. -->
            <div class="columns is-centered has-text-centered">
                <div class="column is-three-quarters">
                    <h2 class="title is-3">Abstract</h2>
                    <div class="content has-text-justified">
                        <p>
                            The recent wave of large-scale text-to-image diffusion models has dramatically increased our text-based image generation abilities. These models can generate realistic images for a staggering variety of prompts and exhibit impressive compositional generalization abilities. 
                        </p>
                        <p>
                            Almost all use cases thus far have solely focused on <i>sampling</i>; however, diffusion models can also provide conditional density estimates, which are useful for tasks beyond image generation.
                        </p>
                        <p>
                            In this paper, we show that the density estimates from large-scale text-to-image diffusion models like Stable Diffusion can be leveraged to perform zero-shot classification <strong>without any additional
                                training</strong>.
                                Our generative approach to classification attains strong results on a variety of benchmarks and outperforms alternative methods of extracting knowledge from diffusion models. 
                                We also find that our diffusion-based approach has stronger <i>multimodal</i> relational reasoning abilities than competing contrastive approaches. 
                            </p>
                            <p>
                            Finally, we evaluate diffusion models trained on ImageNet and find that they approach the performance of SOTA discriminative classifiers trained on the same dataset, even with weak augmentations and no regularization.
                        </p>
                    </div>
                </div>
            </div>
            <!--/ Abstract. -->


            <!-- Paper video. -->
            <!-- <p style="padding: 20px;" /> -->
            <!-- <div class="columns is-centered has-text-centered">
                <div class="column is-four-fifths">
                    <h2 class="title is-3">Video</h2>
                    <div class="publication-video">
                        <iframe width="560" height="315" src="https://www.youtube.com/embed/1hYtGZ0CUSA"
                            title="YouTube video player" frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                            allowfullscreen></iframe>
                    </div>
                </div>
            </div> -->
            <!--/ Paper video. -->
        </div>
    </section>

    <!-- TODO -->
    <section class="section">
        <div class="container is-max-desktop">
            <!-- Derivation. -->
            <div class="columns is-centered has-text-centered">
                <div class="column is-three-quarters">
                    <h2 class="title is-3">Classification with diffusion models</h2>
                    <div class="content has-text-justified">
                        <p>
                            In general, classification using a conditional generative model can be done by using Bayes' theorem on the model predictions and the prior \(p(\mathbf{c})\) over labels \(\{\mathbf{c}_i\}\):
                            <!-- $$
                                p_\theta(\mathbf{c}_i \mid \mathbf{x}) = \frac{p(\mathbf{c}_i)\ p_\theta(\mathbf{x} \mid \mathbf{c}_i)}{\sum_j p(\mathbf{c}_j)\ p_\theta(\mathbf{x} \mid \mathbf{c}_j)}
                                \tag{eq:bayes}
                            $$ -->
                            \begin{equation}
                                p_\theta(\mathbf{c}_i \mid \mathbf{x}) = \frac{p(\mathbf{c}_i)\ p_\theta(\mathbf{x} \mid \mathbf{c}_i)}{\sum_j p(\mathbf{c}_j)\ p_\theta(\mathbf{x} \mid \mathbf{c}_j)}
                            \label{eq:bayes}
                            \end{equation}
                        </p>
                        <p>
                            A uniform prior over \(\{\mathbf{c}_i\}\) (<i>i.e.,</i> \(p(\mathbf{c}_i) = \frac{1}{N}\)) is natural and leads to all of the \(p(\mathbf{c})\) terms cancelling. For diffusion models, computing \(p_\theta(\mathbf{x}\mid \mathbf{c})\) is intractable, so we use the ELBO in place of \(\log p_\theta(\mathbf{x} \mid \mathbf{c})\) and use Eq.&nbsp;\ref{eq:elbo} and Eq.&nbsp;\ref{eq:bayes} to obtain a posterior distribution over \(\{\mathbf{c}_i\}_{i=1}^N\):
                            \begin{align}
                                p_\theta(\mathbf{c}_i \mid  \mathbf{x}) 
                                &\approx \frac{\exp\{- \mathbb{E}_{t, \epsilon}[\|\epsilon - \epsilon_\theta(\mathbf{x}_t, \mathbf{c}_i)\|^2] + C \}}{\sum_j \exp\{- \mathbb{E}_{t, \epsilon}[\|\epsilon - \epsilon_\theta(\mathbf{x}_t, \mathbf{c}_j)\|^2] + C\}} \\
                                &= \frac{\exp\{- \mathbb{E}_{t, \epsilon}[\|\epsilon - \epsilon_\theta(\mathbf{x}_t, \mathbf{c}_i)\|^2]\}}{\sum_j \exp\{- \mathbb{E}_{t, \epsilon}[\|\epsilon - \epsilon_\theta(\mathbf{x}_t, \mathbf{c}_j)\|^2]\}} 
                            \label{eq:posterior}
                            \end{align}
                        </p>
                        <p>
                            We compute an unbiased Monte Carlo estimate of each expectation by sampling \(N\) \((t_i, \epsilon_i)\) pairs, with \(t_i \sim [0, 1000]\) and \(\epsilon \sim \mathcal{N}(0, I)\), and computing
                            \begin{align}
                                \frac{1}{N}\sum_{i=1}^N \left\|\epsilon_i - \epsilon_\theta(\sqrt{\bar \alpha_{t_i}}\mathbf{x} + \sqrt{1-\bar\alpha_{t_i}} \epsilon_i, \mathbf{c}_j)\right\|^2
                            \label{eq:monte_carlo}
                            \end{align}
                        </p>
                        <p>
                            By plugging Eq.~\ref{eq:monte_carlo} into Eq.~\ref{eq:posterior}, we can extract a classifier from any conditional diffusion model. We call this method \textbf{\model}.
                            \textit{\model is a powerful, hyperparameter-free approach to extracting classifiers from pretrained diffusion models without any additional training.}
                            \model can be used to extract a zero-shot classifier from a text-to-image model like Stable Diffusion \cite{rombach2022high}, to extract a standard classifier from a class-conditional diffusion model like DiT \cite{Peebles2022DiT}, and so on. We show an overview of our method in Figure~\ref{fig:method}. 
                        </p>
                    </div>
                </div>
            </div>
            <!--/ Derivation. -->
        </div>
    </section>

    <section class="section">
        <div class="container is-max-desktop">
            <!-- Setting. -->
            <!-- <div class="columns is-centered has-text-centered">
                <div class="column is-three-quarters">
                    <h2 class="title is-3">Learn a task-specific model by exploring the web</h2>
                    <div class="content has-text-justified">
                        <p>
                            Given unlabeled data for a target task, <span class="method-name">Internet
                                Explorer</span> searches the Internet to progressively find more and more relevant
                            training data via self-supervised training.
                        </p>
                    </div>
                    <video id="setting-video" autoplay muted playsinline height="100%"
                        poster="./static/images/explorer_setting.jpg" class="mp4-gif">
                        <source src="./static/videos/ie_setting.mp4" type="video/mp4">
                    </video>
                </div>
            </div> -->
            <!--/ Setting. -->
        </div>
    </section>


    <section class="section">
        <div class="container is-max-desktop">
            <!-- Method Overview -->
            <div class="columns is-centered has-text-centered">
                <div class="column is-three-quarters">
                    <h2 class="title is-3">Method Overview</h2>
                    <div class="content has-text-justified ">
                        <p>
                            <span class="method-name">Diffusion Classifier</span> iteratively repeats 4 steps to find and
                            learn
                            from relevant Internet data.
                            It cycles between searching for images on the Internet with text queries, self-supervised
                            training on downloaded images, determining which images are relevant to the target dataset,
                            and prioritizing what to search for next.
                        </p>
                    </div>
                </div>
            </div>
            <p style="padding: 10px;" />
            <div class="columns is-centered has-text-centered">
                <div class="column">
                    <div id="method-overview-wrapper">
                        <img src="./static/images/arch_figure.jpg" alt="Internet Explorer method."
                            class="method-overview-full-img  method-overview" draggable="false" />
                    </div>
                    <p style="padding: 10px;" />
                    <div>
                        <div class="method-overview-full-img method-overview">
                            <div class="method-overview-title">Overview of <span class="method-name">Diffusion Classifier</span> approach</div>
                            <div class="method-overview-text has-text-justified">
                                <p>
                                    <!-- TODO: -->
                                    Given an input image and a set of possible conditioning inputs (e.g., text for Stable Diffusion or class index for DiT), we want to use a diffusion model to choose the one that best fits this image. <span class="method-name">Diffusion Classifier</span>  is theoretically motivated through the variational view of diffusion models and uses the ELBO to approximate
                                    \(\log p_{\theta}(x|\mathbf c).\)
                                    <span class="method-name">Diffusion Classifier</span> chooses the conditioning
                                    \(\mathbf c\)
                                    that best predicts the noise added to the input image. <span class="method-name">Diffusion Classifier</span>  can be used to extract a <u>zero-shot classifier from a text-to-image model (like Stable Diffusion)</u> and a <u>standard classifier from a class-conditional model (like DiT)</u> without any additional training
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--/ Method Overview -->

        </div>
    </section>

    <section class="section">
        <!-- Progression. -->
        <div class="is-centered has-text-centered">
            <div class="table-container is-max-desktop">
                <table style="width:100%">
                    <tr>
                        <th></th>
                        <th>Zero-shot?</th>
                        <th>Food</th>
                        <th>CIFAR10</th>
                        <th>FGVC</th>
                        <th>Pets</th>
                        <th>Flowers</th>
                        <th>MNIST</th>
                        <th>STL10</th>
                        <th>ImageNet</th>
                        <th>ObjectNet</th>
                    </tr>
                    <tr>
                        <td colspan="11" style="border-bottom: 1px solid #ddd;"></td>
                    </tr>
                    <tr>
                        <td class="td-la">Synthetic SD Data</td>
                        <!-- <td>&#10003;</td> -->
                        <td style="color:lime">&#10003;</td>
                        <td>12.6</td>
                        <td>35.3</td>
                        <td>9.4</td>
                        <td>31.3</td>
                        <td>22.1</td>
                        <td>27.9</td>
                        <td>38.0</td>
                        <td>18.9</td>
                        <td>5.2</td>
                    </tr>
                    <tr>
                        <td>SD Features</td>
                        <td style="color:red">&#10007;</td>
                        <td style="color:lightgray">73.0</td>
                        <td style="color:lightgray"><b>84.0</b></td>
                        <td style="color:lightgray"><b>35.2</b></td>
                        <td style="color:lightgray">75.9</td>
                        <td style="color:lightgray"><b>70.0</b></td>
                        <td style="color:lightgray"><b>98.1</b></td>
                        <td style="color:lightgray">87.2</td>
                        <td style="color:lightgray">56.6</td>
                        <td style="color:lightgray">10.2</td>
                    </tr>
                    <tr>
                        <td>Diffusion Classifier (ours)</td>
                        <td style="color:lime">&#10003;</td>
                        <td><b>77.9</b></td>
                        <td>76.3</td>
                        <td>24.3</td>
                        <td><b>85.7</b></td>
                        <td>56.8</td>
                        <td>17.4</td>
                        <td><b>94.2</b></td>
                        <td><b>58.4</b></td>
                        <td><b>38.3</b></td>
                    </tr>
                    <tr>
                        <td colspan="11" style="border-bottom: 1px solid #ddd;"></td>
                    </tr>
                    <tr>
                        <td>CLIP ViT-L/14</td>
                        <td style="color:lime">&#10003;</td>
                        <td>93.1</td>
                        <td>94.5</td>
                        <td>32.7</td>
                        <td>93.7</td>
                        <td>79.3</td>
                        <td>62.6</td>
                        <td>99.5</td>
                        <td>73.5</td>
                        <td>68.5</td>
                    </tr>
                    <tr>
                        <td>OpenCLIP ViT-H/14</td>
                        <td style="color:lime">&#10003;</td>
                        <td>92.7</td>
                        <td>97.3</td>
                        <td>42.3</td>
                        <td>94.6</td>
                        <td>79.9</td>
                        <td>78.2</td>
                        <td>98.3</td>
                        <td>76.8</td>
                        <td>69.2</td>
                    </tr>
                </table>
            </div>
        </div>
        <!--/ Progression. -->
    </section>

    <section class="section" id="paper">
        <div class="container is-mobile">
            <div class="columns is-centered has-text-centered">
                <div class="container content">
                    <h2 class="title is-3">BibTeX</h2>
                    <div id="bibtex" class="column has-text-justified is-centered">
                        <!-- https://github.com/SaswatPadhi/prismjs-bibtex -->
                        <pre><code class="language-bibtex">@misc{li2023internet,
    title={Internet Explorer: Targeted Representation Learning on the Open Web}, 
    author={Alexander C. Li and Ellis Brown and Alexei A. Efros and Deepak Pathak},
    year={2023},
    eprint={2302.14051},
    archivePrefix={arXiv},
    primaryClass={cs.LG}
}</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="content has-text-centered">
                <!-- TODO: UPDATE -->
                <a class="icon-link" href="https://arxiv.org/abs/2302.14051" target="_blank">
                    <i class="ai ai-arxiv"></i>
                </a>
                &nbsp;
                <!-- TODO: UPDATE -->
                <a class="icon-link" href="./static/docs/InternetExplorer.pdf" target="_blank">
                    <i class="fas fa-file-pdf"></i>
                </a>
                <!-- &nbsp;
                <a class="icon-link" href="https://youtu.be/1hYtGZ0CUSA" target="_blank">
                    <i class="fab fa-youtube"></i>
                </a> -->
                <!-- &nbsp;
                <a class="icon-link" href="./static/docs/InternetExplorer.pptx" target="_blank">
                    <i class="fas fa-file-powerpoint"></i>
                </a> -->
                &nbsp;
                <a class="icon-link" href="https://github.com/diffusion-classifier/diffusion-classifier"
                    target="_blank">
                    <i class="fab fa-github"></i>
                </a>
            </div>
            <div class="columns is-centered">
                <div class="content">
                    <p>
                        Page source code was adapted from <a href="https://internet-explorer-ssl.github.io"
                            target="_blank">here</a>
                        and can be found in <a
                            href="https://github.com/diffusion-classifier/diffusion-classifier.github.io"
                            target="_blank">this repository</a>.
                    </p>
                </div>
            </div>
    </footer>

    <script src="./static/js/index.js"></script>
    <script src="./static/js/prism.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs-bibtex@2.0.1/prism-bibtex.js"
        integrity="sha256-+dK6uqUp/DnP6ef97s8XcoynBnGe5vM5gvBECH0EB3U=" crossorigin="anonymous">
        </script>
</body>

</html>